<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>企微智慧导购数据仪表板 - WilliamLeng</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* 加载动画 */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #2a1f3d 0%, #3d2c5f 50%, #2a1f3d 100%);
            color: #ffffff;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* 水印背景纹理 */
        .watermark-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 180px,
                    rgba(255, 255, 255, 0.015) 180px,
                    rgba(255, 255, 255, 0.015) 200px
                );
            pointer-events: none;
            z-index: 1000;
        }
        
        .watermark {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
            background: 
                repeating-linear-gradient(
                    45deg,
                    transparent 0,
                    transparent 200px,
                    rgba(139, 92, 246, 0.02) 200px,
                    rgba(139, 92, 246, 0.02) 300px
                ),
                repeating-linear-gradient(
                    -45deg,
                    transparent 0,
                    transparent 200px,
                    rgba(99, 102, 241, 0.015) 200px,
                    rgba(99, 102, 241, 0.015) 300px
                );
        }
        

        
        .watermark::before {
            content: '仅限方太内部使用';
            position: absolute;
            top: 48%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 42px;
            font-weight: 600;
            color: rgba(139, 92, 246, 0.25);
            white-space: nowrap;
            letter-spacing: 10px;
            text-shadow: 0 0 30px rgba(139, 92, 246, 0.35);
            user-select: none;
            z-index: 999;
        }
        
        .watermark::after {
            content: '互联网应用技术部 产品管理模块 AI探索';
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 42px;
            font-weight: 600;
            color: rgba(99, 102, 241, 0.25);
            white-space: nowrap;
            letter-spacing: 10px;
            text-shadow: 0 0 30px rgba(99, 102, 241, 0.35);
            user-select: none;
            z-index: 999;
        }
        
        @keyframes watermark-pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* 详情弹窗样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: linear-gradient(145deg, #2a1f3d 0%, #3d2c5f 100%);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 16px;
            padding: 32px;
            max-width: 95vw;
            max-height: 95vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            width: 1200px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
            background: linear-gradient(135deg, #8B5CF6, #06B6D4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 28px;
            cursor: pointer;
            padding: 5px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            color: #fff;
            background: rgba(239, 68, 68, 0.2);
        }

        .detail-metrics {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .detail-metrics.grid-2 {
            grid-template-columns: 1fr 1fr;
        }

        .detail-metrics.grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .detail-metrics.grid-4 {
            grid-template-columns: repeat(2, 1fr);
        }

        .detail-metric-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .detail-metric-title {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
        }

        .detail-metric-value {
            font-size: 24px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 5px;
        }

        .detail-metric-change {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .detail-metric-change.positive {
            background: rgba(16, 185, 129, 0.2);
            color: #10B981;
        }

        .detail-metric-change.negative {
            background: rgba(239, 68, 68, 0.2);
            color: #EF4444;
        }

        .detail-metric-change.neutral {
            background: rgba(139, 92, 246, 0.2);
            color: #8B5CF6;
        }

        .detail-chart-section {
            margin-top: 30px;
        }

        .detail-chart-title {
            font-size: 18px;
            font-weight: 500;
            color: #fff;
            margin-bottom: 20px;
            text-align: center;
        }

        .detail-chart-container {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            padding: 20px;
            height: 400px;
        }

        .modal-charts-grid {
            display: grid;
            gap: 20px;
            margin-top: 15px;
        }

        .modal-charts-grid.grid-2 {
            grid-template-columns: 1fr 1fr;
        }

        .modal-charts-grid.grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .modal-charts-grid.grid-4 {
            grid-template-columns: repeat(2, 1fr);
        }

        .modal-charts-grid.grid-5 {
            grid-template-columns: repeat(3, 1fr);
        }

        .modal-charts-grid.grid-6 {
            grid-template-columns: repeat(3, 1fr);
        }

        .modal-charts-grid.grid-7 {
            grid-template-columns: repeat(3, 1fr);
        }

        .metric-chart-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            padding: 16px;
        }

        .metric-chart-title {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 12px;
            text-align: center;
        }

        .metric-chart-canvas {
            height: 250px;
            position: relative;
        }

        /* 详情页面布局增强 */
        .detail-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
            padding-bottom: 15px;
        }

        .detail-tab {
            padding: 8px 16px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .detail-tab.active {
            background: linear-gradient(135deg, #8B5CF6, #06B6D4);
            color: #fff;
            border-color: transparent;
        }

        .detail-tab:hover:not(.active) {
            background: rgba(139, 92, 246, 0.2);
            color: #fff;
        }

        .detail-content {
            display: none;
        }

        .detail-content.active {
            display: block;
        }

        .detail-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .detail-filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .detail-filter-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }

        .detail-filter-select {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 8px;
            padding: 6px 12px;
            color: #fff;
            font-size: 13px;
            min-width: 120px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .charts-grid.three-col {
            grid-template-columns: 1fr 1fr 1fr;
        }

        .charts-grid.single-col {
            grid-template-columns: 1fr;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            padding: 20px;
        }

        .chart-card-title {
            font-size: 16px;
            font-weight: 500;
            color: #fff;
            margin-bottom: 15px;
            text-align: center;
        }

        .chart-card-canvas {
            height: 300px;
        }


        
        /* 简约扫描线效果 */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.8), transparent);
            animation: scan 4s ease-in-out infinite;
            z-index: 1000;
        }
        
        @keyframes scan {
            0% { top: 0; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100vh; opacity: 0; }
        }
        
        .header {
            background: 
                linear-gradient(135deg, rgba(20, 14, 35, 0.98) 0%, rgba(42, 31, 61, 0.95) 25%, rgba(61, 44, 95, 0.95) 50%, rgba(42, 31, 61, 0.95) 75%, rgba(20, 14, 35, 0.98) 100%),
                radial-gradient(ellipse at 15% 20%, rgba(139, 92, 246, 0.15) 0%, transparent 60%),
                radial-gradient(ellipse at 85% 80%, rgba(99, 102, 241, 0.12) 0%, transparent 60%),
                radial-gradient(ellipse at 50% 50%, rgba(6, 182, 212, 0.05) 0%, transparent 70%),
                conic-gradient(from 0deg at 20% 30%, transparent 0deg, rgba(139, 92, 246, 0.03) 60deg, transparent 120deg),
                conic-gradient(from 180deg at 80% 70%, transparent 0deg, rgba(99, 102, 241, 0.03) 60deg, transparent 120deg),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><defs><pattern id="tech-grid" patternUnits="userSpaceOnUse" width="40" height="40"><circle cx="20" cy="20" r="1.5" fill="rgba(139,92,246,0.15)"/><circle cx="10" cy="10" r="0.8" fill="rgba(99,102,241,0.1)"/><circle cx="30" cy="30" r="0.8" fill="rgba(99,102,241,0.1)"/><path d="M15,15 L25,25 M25,15 L15,25" stroke="rgba(139,92,246,0.08)" stroke-width="0.5"/><rect x="18" y="18" width="4" height="4" rx="1" fill="none" stroke="rgba(6,182,212,0.1)" stroke-width="0.3"/></pattern></defs><rect width="100%" height="100%" fill="url(%23tech-grid)"/></svg>');
            backdrop-filter: blur(25px);
            padding: 32px 24px;
            border-bottom: 2px solid transparent;
            border-image: linear-gradient(90deg, rgba(139, 92, 246, 0.4), rgba(6, 182, 212, 0.3), rgba(99, 102, 241, 0.4), rgba(6, 182, 212, 0.3), rgba(139, 92, 246, 0.4)) 1;
            position: sticky;
            top: 0;
            z-index: 100;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(45deg, transparent 40%, rgba(139, 92, 246, 0.08) 50%, transparent 60%),
                linear-gradient(-45deg, transparent 40%, rgba(99, 102, 241, 0.06) 50%, transparent 60%),
                linear-gradient(90deg, transparent 0%, rgba(6, 182, 212, 0.03) 50%, transparent 100%);
            pointer-events: none;
            animation: header-shimmer 8s ease-in-out infinite;
        }
        
        .header::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(ellipse at center, transparent 30%, rgba(139, 92, 246, 0.03) 40%, transparent 70%),
                conic-gradient(from 0deg, transparent, rgba(6, 182, 212, 0.02), transparent, rgba(99, 102, 241, 0.02), transparent);
            animation: header-rotate 20s linear infinite;
            pointer-events: none;
            z-index: 1;
        }
        
        @keyframes header-shimmer {
            0%, 100% { opacity: 0.5; transform: translateX(0); }
            50% { opacity: 1; transform: translateX(10px); }
        }
        
        @keyframes header-rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .header h1 {
            text-align: center;
            font-size: 32px;
            font-weight: 600;
            background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 25%, #c7d2fe 50%, #e0e7ff 75%, #ffffff 100%);
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            -webkit-text-fill-color: transparent;
            margin-bottom: 24px;
            letter-spacing: -0.5px;
            position: relative;
            z-index: 3;
            text-shadow: 0 0 30px rgba(139, 92, 246, 0.3);
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }
        
        .filters {
            display: flex;
            justify-content: center;
            gap: 24px;
            flex-wrap: wrap;
            position: relative;
            z-index: 3;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .filter-label {
            font-size: 13px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        select {
            background: rgba(61, 44, 95, 0.6);
            border: 1px solid rgba(156, 163, 175, 0.3);
            color: #ffffff;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            outline: none;
        }
        
        select:hover {
            background: rgba(61, 44, 95, 0.8);
            border-color: rgba(156, 163, 175, 0.5);
        }
        
        select:focus {
            border-color: rgba(99, 102, 241, 0.8);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
        }
        
        .metric-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(139, 92, 246, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .metric-title {
            font-size: 14px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 12px;
        }
        
        .metric-value {
            font-size: 36px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
            line-height: 1;
        }
        
        .metric-change {
            font-size: 14px;
            font-weight: 500;
        }
        
        .positive { 
            color: #10B981; 
        }
        
        .negative { 
            color: #EF4444; 
        }
        
        .neutral { 
            color: rgba(255, 255, 255, 0.6);
        }
        
        .chart-section {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 24px;
            text-align: center;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            height: 400px;
        }
        
        .features-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 20px;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }
        
        .feature-card:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.15);
        }
        
        .feature-card::after {
            content: '点击查看详情 →';
            position: absolute;
            bottom: 12px;
            right: 15px;
            font-size: 11px;
            color: rgba(139, 92, 246, 0.6);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .feature-card:hover::after {
            opacity: 1;
        }

        /* 更多功能卡片不显示点击提示 */
        .feature-card[data-placeholder]::after {
            content: none;
        }
        
        .feature-card[data-placeholder] {
            cursor: default;
        }
        
        .feature-card[data-placeholder]:hover {
            transform: none;
            box-shadow: none;
        }
        
        .feature-card.growing {
            border-color: rgba(16, 185, 129, 0.4);
            background: rgba(16, 185, 129, 0.03);
        }
        
        .feature-card.declining {
            border-color: rgba(239, 68, 68, 0.4);
            background: rgba(239, 68, 68, 0.03);
        }
        
        .feature-card.stable {
            border-color: rgba(139, 92, 246, 0.4);
            background: rgba(139, 92, 246, 0.03);
        }
        
        .feature-header {
            margin-bottom: 16px;
        }
        
        .feature-title {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
        }
        


        .feature-metrics {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
            border-left: 3px solid rgba(139, 92, 246, 0.5);
        }

        .metric-label {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }

        .metric-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .metric-value {
            font-size: 14px;
            color: #fff;
            font-weight: 600;
        }

        .metric-change {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 8px;
            font-weight: 600;
        }

        .metric-change.positive {
            background: rgba(16, 185, 129, 0.2);
            color: #10B981;
        }

        .metric-change.negative {
            background: rgba(239, 68, 68, 0.2);
            color: #EF4444;
        }

        .metric-change.neutral {
            background: rgba(139, 92, 246, 0.2);
            color: #8B5CF6;
        }
        
        .mini-chart {
            height: 80px;
            margin: 12px 0;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
            padding: 8px;
        }
        
        .download-section {
            text-align: center;
            margin-top: 32px;
            padding: 24px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
        }
        
        .download-section h3 {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 12px;
        }
        
        .download-btn {
            background: rgb(139, 92, 246);
            color: #ffffff;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            outline: none;
        }
        
        .download-btn:hover {
            background: rgb(124, 58, 237);
            transform: translateY(-1px);
        }
        
        .query-btn {
            background: linear-gradient(135deg, #10B981, #059669);
            color: #ffffff;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            margin-top: 20px;
        }
        
        .query-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }
        
        .query-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }
        
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
                align-items: center;
            }
            
            .features-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- 水印层 -->
    <div class="watermark-bg"></div>
    <div class="watermark"></div>
    
    <div class="header">
        <h1>🏠 方太厨电·企微智慧导购数据中心</h1>
        <div class="filters">
            <div class="filter-group">
                <div class="filter-label">数据周期</div>
                <select id="timeRange">
                    <option>最近3个月</option>
                    <option selected>最近6个月</option>
                    <option>最近12个月</option>
                </select>
            </div>
            <div class="filter-group">
                <div class="filter-label">结束月份</div>
                <select id="endMonth">
                    <option value="2025-06" selected>2025年6月</option>
                    <option value="2025-05">2025年5月</option>
                    <option value="2025-04">2025年4月</option>
                    <option value="2025-03">2025年3月</option>
                    <option value="2025-02">2025年2月</option>
                </select>
            </div>
            <div class="filter-group">
                <div class="filter-label">组织层级</div>
                <select id="orgLevel">
                    <option selected>整体</option>
                    <option disabled style="color: #888;">大区（暂无数据）</option>
                    <option disabled style="color: #888;">分公司（暂无数据）</option>
                </select>
            </div>
            <div class="filter-group">
                <div class="filter-label">对比维度</div>
                <select id="compareType">
                    <option selected>环比</option>
                    <option disabled style="color: #888;">同比（暂无数据）</option>
                    <option>绝对值</option>
                </select>
            </div>
            <div class="filter-group">
                <button id="queryBtn" class="query-btn">
                    🔍 查询数据
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- 数据说明和范围提示 -->
        <div style="margin-bottom: 20px;">
            <div style="text-align: center; margin-bottom: 12px; padding: 10px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); font-size: 13px;">
                📋 <strong>数据说明</strong>：2025年2-6月整体数据，支持动态环比分析 | 增长率排行显示选择月份所有指标的环比增长率排名 | 大区/分公司和同比数据暂未收集
            </div>
            <div id="dataRangeInfo" style="text-align: center; padding: 12px; background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.8); font-size: 14px;">
            📅 当前显示：<span id="currentRange">最近6个月 (2024年1月 - 2024年6月)</span>
                <div style="font-size: 12px; margin-top: 6px; opacity: 0.7;">💡 修改筛选条件后，点击"查询数据"按钮更新图表</div>
            </div>
        </div>
        
        <!-- 核心指标卡片 -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-title">💼 企微开通人数</div>
                <div class="metric-value">30,990</div>
                <div class="metric-change neutral">—</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">🔐 企微登录人数</div>
                <div class="metric-value">20,926</div>
                <div class="metric-change neutral">—</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">🛍️ 企微智慧导购访问人数</div>
                <div class="metric-value">6,489</div>
                <div class="metric-change neutral">—</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">⚡ 企微智慧导购使用人数</div>
                <div class="metric-value">4,517</div>
                <div class="metric-change neutral">—</div>
            </div>
        </div>

        <!-- 主趋势图 -->
        <div class="chart-section">
            <div class="section-title">📈 核心指标趋势分析</div>
            <div class="charts-grid">
                <div class="chart-container">
                    <canvas id="mainTrendChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="growthChart"></canvas>
                </div>
            </div>
        </div>

        <!-- 用户活跃度分析 -->
        <div class="chart-section">
            <div class="section-title">📊 用户活跃度分析</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="chart-container">
                    <canvas id="dailyActiveChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="monthlyActiveChart"></canvas>
                </div>
            </div>
        </div>

        <!-- 功能模块分析 -->
        <div class="chart-section">
            <div class="section-title">🎯 功能模块使用情况</div>
            <div class="features-section">
                <div class="feature-card growing">
                    <div class="feature-header">
                        <div class="feature-title">🏥 厨房健康检测</div>
                    </div>
                    <div class="feature-metrics">
                        <div class="metric-item">
                            <div class="metric-label">使用人数</div>
                            <div class="metric-right">
                                <div class="metric-value">1,168</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">创建数量</div>
                            <div class="metric-right">
                                <div class="metric-value">5,615</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">分享次数</div>
                            <div class="metric-right">
                                <div class="metric-value">3,276</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="feature-card growing">
                    <div class="feature-header">
                        <div class="feature-title">💬 欢迎语管理</div>
                    </div>
                    <div class="feature-metrics">
                        <div class="metric-item">
                            <div class="metric-label">已触发好友数</div>
                            <div class="metric-right">
                                <div class="metric-value">369,990</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">打开数</div>
                            <div class="metric-right">
                                <div class="metric-value">239,854</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">产生线索数</div>
                            <div class="metric-right">
                                <div class="metric-value">30,686</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="feature-card growing">
                    <div class="feature-header">
                        <div class="feature-title">👥 朋友圈管理</div>
                    </div>
                    <div class="feature-metrics">
                        <div class="metric-item">
                            <div class="metric-label">应执行员工人次</div>
                            <div class="metric-right">
                                <div class="metric-value">799,776</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">创建数量</div>
                            <div class="metric-right">
                                <div class="metric-value">96</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">已执行员工人次</div>
                            <div class="metric-right">
                                <div class="metric-value">22,717</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="feature-card growing">
                    <div class="feature-header">
                        <div class="feature-title">🛒 选购指南</div>
                    </div>
                    <div class="feature-metrics">
                        <div class="metric-item">
                            <div class="metric-label">使用人数</div>
                            <div class="metric-right">
                                <div class="metric-value">75</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">创建+更新数量</div>
                            <div class="metric-right">
                                <div class="metric-value">125</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">分享数量</div>
                            <div class="metric-right">
                                <div class="metric-value">112</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="feature-card growing">
                    <div class="feature-header">
                        <div class="feature-title">🤖 AI问答</div>
                    </div>
                    <div class="feature-metrics">
                        <div class="metric-item">
                            <div class="metric-label">使用人数</div>
                            <div class="metric-right">
                                <div class="metric-value">76</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">使用人次</div>
                            <div class="metric-right">
                                <div class="metric-value">369</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="feature-card growing">
                    <div class="feature-header">
                        <div class="feature-title">🏪 门店活动</div>
                    </div>
                    <div class="feature-metrics">
                        <div class="metric-item">
                            <div class="metric-label">创建数量</div>
                            <div class="metric-right">
                                <div class="metric-value">10</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">审核通过数量</div>
                            <div class="metric-right">
                                <div class="metric-value">3</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">浏览量</div>
                            <div class="metric-right">
                                <div class="metric-value">0</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="feature-card growing">
                    <div class="feature-header">
                        <div class="feature-title">🏠 厨房案例</div>
                    </div>
                    <div class="feature-metrics">
                        <div class="metric-item">
                            <div class="metric-label">总数量</div>
                            <div class="metric-right">
                                <div class="metric-value">5,260</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">分享量</div>
                            <div class="metric-right">
                                <div class="metric-value">8,790</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="feature-card growing">
                    <div class="feature-header">
                        <div class="feature-title">🎯 用户服务卡</div>
                    </div>
                    <div class="feature-metrics">
                        <div class="metric-item">
                            <div class="metric-label">分享人数</div>
                            <div class="metric-right">
                                <div class="metric-value">285</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">分享人次</div>
                            <div class="metric-right">
                                <div class="metric-value">2,398</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">NPS评分</div>
                            <div class="metric-right">
                                <div class="metric-value">0</div>
                                <div class="metric-change neutral">—</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="feature-card stable" data-placeholder="true" style="border: 2px dashed rgba(139, 92, 246, 0.4); background: rgba(139, 92, 246, 0.02);">
                    <div class="feature-header">
                        <div class="feature-title">➕ 更多功能</div>
                    </div>
                    <div style="height: 120px; margin: 12px 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.02); border-radius: 6px; padding: 16px; text-align: center;">
                        <div style="color: rgba(255, 255, 255, 0.6); font-size: 14px; margin-bottom: 8px;">🚀 即将推出更多智能功能</div>
                        <div style="color: rgba(255, 255, 255, 0.4); font-size: 12px;">新功能模块将在此展示<br/>支持功能扩展 | 持续优化中</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 下载报表区域 -->
        <div class="download-section">
            <h3>📊 导出数据报表</h3>
            <p style="margin: 10px 0; opacity: 0.8;">一键下载完整数据报表，包含所有功能的详细统计</p>
            <button class="download-btn" onclick="downloadReport()">📥 下载Excel报表</button>
        </div>
    </div>

    <script>
        // 主趋势图
        const mainCtx = document.getElementById('mainTrendChart').getContext('2d');
        window.usageTrendChart = new Chart(mainCtx, {
            type: 'line',
            data: {
                labels: ['2月', '3月', '4月', '5月', '6月'],
                datasets: [{
                    label: '企微开通人数',
                    data: [30990, 31734, 32913, 33672, 33824],
                    borderColor: '#06B6D4',
                    backgroundColor: 'rgba(6, 182, 212, 0.1)',
                    tension: 0.4,
                    borderWidth: 3,
                    pointBackgroundColor: '#06B6D4',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 5
                }, {
                    label: '企微登录人数',
                    data: [20926, 22941, 27823, 29051, 29247],
                    borderColor: '#8B5CF6',
                    backgroundColor: 'rgba(139, 92, 246, 0.1)',
                    tension: 0.4,
                    borderWidth: 3,
                    pointBackgroundColor: '#8B5CF6',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 5
                }, {
                    label: '企微智慧导购访问人数',
                    data: [6489, 8104, 11436, 13285, 13434],
                    borderColor: '#10B981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    tension: 0.4,
                    borderWidth: 3,
                    pointBackgroundColor: '#10B981',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 5
                }, {
                    label: '企微智慧导购使用人数',
                    data: [4517, 5848, 8254, 10179, 10999],
                    borderColor: '#F59E0B',
                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                    tension: 0.4,
                    borderWidth: 3,
                    pointBackgroundColor: '#F59E0B',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 5
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: '核心指标月度趋势',
                        color: '#ffffff',
                        font: { size: 16 }
                    },
                    legend: {
                        labels: {
                            color: '#ffffff',
                            usePointStyle: true
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: { 
                            color: '#ffffff',
                            callback: function(value) {
                                return value.toLocaleString();
                            }
                        },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    },
                    x: {
                        ticks: { color: '#ffffff' },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    }
                }
            }
        });

        // 增长率图表 - 显示具体指标增长率排名
        const growthCtx = document.getElementById('growthChart').getContext('2d');
        window.growthChart = new Chart(growthCtx, {
            type: 'bar',
            data: {
                labels: ['用户服务卡-分享人次', '用户服务卡-NPS人数', '厨房健康检测-分享次数', '厨房案例-分享量', '欢迎语-触发好友数'],
                datasets: [{
                    label: '增长率 (%)',
                    data: [446, 196, 175, 127, 86],
                    backgroundColor: [
                        'rgba(16, 185, 129, 0.8)',
                        'rgba(6, 182, 212, 0.8)',
                        'rgba(139, 92, 246, 0.8)',
                        'rgba(245, 158, 11, 0.8)',
                        'rgba(236, 72, 153, 0.8)'
                    ],
                    borderColor: [
                        '#10B981',
                        '#06B6D4',
                        '#8B5CF6',
                        '#F59E0B',
                        '#EC4899'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: '核心指标增长率排行',
                        color: '#ffffff',
                        font: { size: 16 }
                    },
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        ticks: { 
                            color: '#ffffff',
                            callback: function(value) {
                                return value + '%';
                            }
                        },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    },
                    x: {
                        ticks: { color: '#ffffff' },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    }
                }
            }
        });

        // 日活趋势图
        const dailyActiveCtx = document.getElementById('dailyActiveChart').getContext('2d');
        window.dailyActiveChart = new Chart(dailyActiveCtx, {
            type: 'line',
            data: {
                labels: ['2月', '3月', '4月', '5月', '6月'],
                datasets: [{
                    label: '全体日活',
                    data: [1075, 1572, 1965, 2637, 2904],
                    borderColor: '#10B981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    tension: 0.4,
                    borderWidth: 3,
                    pointBackgroundColor: '#10B981',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    spanGaps: false
                }, {
                    label: '三类人员日活',
                    data: [884, 1279, 1604, 2171, 2411],
                    borderColor: '#06B6D4',
                    backgroundColor: 'rgba(6, 182, 212, 0.1)',
                    tension: 0.4,
                    borderWidth: 3,
                    pointBackgroundColor: '#06B6D4',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    spanGaps: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: '日活用户数趋势',
                        color: '#ffffff',
                        font: { size: 16 }
                    },
                    legend: {
                        labels: {
                            color: '#ffffff',
                            usePointStyle: true
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: { 
                            color: '#ffffff',
                            callback: function(value) {
                                return value.toLocaleString();
                            }
                        },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    },
                    x: {
                        ticks: { color: '#ffffff' },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    }
                }
            }
        });

        // 月活趋势图
        const monthlyActiveCtx = document.getElementById('monthlyActiveChart').getContext('2d');
        window.monthlyActiveChart = new Chart(monthlyActiveCtx, {
            type: 'line',
            data: {
                labels: ['2月', '3月', '4月', '5月', '6月'],
                datasets: [{
                    label: '全体月活',
                    data: [6488, 8102, 11434, 13283, 13434],
                    borderColor: '#8B5CF6',
                    backgroundColor: 'rgba(139, 92, 246, 0.1)',
                    tension: 0.4,
                    borderWidth: 3,
                    pointBackgroundColor: '#8B5CF6',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    spanGaps: false
                }, {
                    label: '三类人员月活',
                    data: [4949, 6181, 8545, 9818, 10223],
                    borderColor: '#F59E0B',
                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                    tension: 0.4,
                    borderWidth: 3,
                    pointBackgroundColor: '#F59E0B',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    spanGaps: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: '月活用户数趋势',
                        color: '#ffffff',
                        font: { size: 16 }
                    },
                    legend: {
                        labels: {
                            color: '#ffffff',
                            usePointStyle: true
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: { 
                            color: '#ffffff',
                            callback: function(value) {
                                return value.toLocaleString();
                            }
                        },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    },
                    x: {
                        ticks: { color: '#ffffff' },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    }
                }
            }
        });



        // 下载报表功能
        function downloadReport() {
            try {
                // 获取当前查询的时间范围
                const timeRange = document.getElementById('timeRange').value;
                const endMonth = document.getElementById('endMonth').value;
                const monthsToShow = parseInt(timeRange.replace('最近', '').replace('个月', ''));
                
                // 使用与图表相同的数据生成逻辑
                const { displayMonths, actualDataRange } = generateExportData(endMonth, monthsToShow);
                
                // 生成CSV内容
                let csvContent = '\uFEFF'; // BOM头，确保Excel正确显示中文
                
                // 1. 添加标题和筛选信息
                csvContent += '方太企微数据分析报表\n';
                csvContent += `查询时间范围：${timeRange}\n`;
                csvContent += `结束月份：${endMonth}\n`;
                csvContent += `实际数据范围：${actualDataRange}\n`;
                csvContent += `生成时间：${new Date().toLocaleString('zh-CN')}\n\n`;
                
                // 2. 核心指标数据
                // 使用页面中已定义的fullData（在script底部定义）
                const pageFullData = window.fullData || {
                    months: ['2月', '3月', '4月', '5月', '6月'],
                    coreMetrics: {
                        '企微开通人数': [30990, 31734, 32913, 33672, 33824],
                        '企微登录人数': [20926, 22941, 27823, 29051, 29247],
                        '企微智慧导购访问人数': [6489, 8104, 11436, 13285, 13434],
                        '企微智慧导购使用人数': [4517, 5848, 8254, 10179, 10999]
                    },
                    modules: {
                        '厨房健康检测': {
                            '使用人数': [1168, 1869, 2995, 4410, 6222],
                            '创建数量': [5615, 15504, 26161, 43693, 76320],
                            '分享数量': [3276, 8663, 12060, 10028, 27549]
                        },
                        '欢迎语': {
                            '创建条数': [380, 389, 447, 513, 603],
                            '已触发好友数': [369990, 382583, 463006, 641248, 1190926],
                            '打开数': [239854, 250055, 270790, 297712, 363798],
                            '打开率': [65, 65, 58, 46, 31],
                            '产生线索数': [30686, 32291, 35036, 38321, 45069],
                            '活跃线索产生率': [12.79, 12.91, 12.94, 12.87, 12.39],
                            '成交线索数': [2157, 2220, 2335, 2517, 2899]
                        },
                        '朋友圈管理': {
                            '创建数量': [96, 170, 123, 180, 195],
                            '应执行员工人次': [799776, 1354483, 736346, 1451003, 1796130],
                            '已执行员工人次': [22717, 36858, 34739, 84353, 95860],
                            '员工执行率': [3, 2.7, 4.7, 5.8, 5.3],
                            '触达顾客次数': [2615312, 3980114, 2677486, 5960501, 9581610]
                        },
                        '选购指南': {
                            '使用人数': [75, 68, 149, 190, 176],
                            '创建+更新数量': [125, 261, 317, 438, 375],
                            '分享数量': [112, 231, 248, 198, 320]
                        },
                        'AI问答': {
                            '使用人数': [76, 609, 1244, 1341, 917],
                            '使用人次': [369, 1857, 3543, 3568, 2591]
                        },
                        '门店活动': {
                            '创建数量': [5, 1, 13, 16, 10],
                            '审核通过数量': [2, 0, 6, 11, 3],
                            '浏览量': [43, 1, 21, 87, 0],
                            '转发数': [15, 2, 3, 9, 0],
                            '线索数': [2, 3, 3, 1, 1],
                            '订单数': [0, 4, 0, 0, 0]
                        },
                        '厨房案例': {
                            '总数量': [3981, 3982, 3982, 3982, 5260],
                            '分享量': [8790, 13376, 15193, 23377, 19889]
                        },
                        '用户服务卡': {
                            '分享人数': [0, 0, 85, 108, 285],
                            '分享人次': [0, 0, 558, 439, 2398],
                            'NPS人数': [0, 0, 98, 85, 252],
                            'NPS评分': [0, 0, 9.783, 9.882, 9.888]
                        }
                    }
                };
                
                csvContent += '核心指标月度趋势\n';
                csvContent += '月份,企微开通人数,企微登录人数,企微智慧导购访问人数,企微智慧导购使用人数\n';
                
                // 生成核心指标的导出数据
                for (let i = 0; i < displayMonths.length; i++) {
                    const monthLabel = displayMonths[i];
                    const dataValues = getCoreMetricValues(pageFullData, monthLabel);
                    if (dataValues.hasData) {
                        csvContent += `${monthLabel},${dataValues.values.join(',')}\n`;
                    } else {
                        csvContent += `${monthLabel},无数据,无数据,无数据,无数据\n`;
                    }
                }
                
                csvContent += '\n';
                
                csvContent += '\n';
                
                // 3. 添加完整的功能模块数据
                
                // 添加各个功能模块的数据
                Object.keys(pageFullData.modules).forEach(moduleName => {
                    csvContent += `${moduleName}\n`;
                    const moduleData = pageFullData.modules[moduleName];
                    const metricNames = Object.keys(moduleData);
                    
                    // 添加表头
                    csvContent += `月份,${metricNames.join(',')}\n`;
                    
                    // 添加数据行
                    for (let i = 0; i < displayMonths.length; i++) {
                        const monthLabel = displayMonths[i];
                        const moduleValues = getModuleValues(pageFullData, moduleName, metricNames, monthLabel);
                        csvContent += `${monthLabel},${moduleValues.values.join(',')}\n`;
                    }
                    
                    csvContent += '\n';
                });
                
                // 4. 添加说明
                csvContent += '说明：\n';
                csvContent += '• 上述数据根据您选择的时间范围动态生成\n';
                csvContent += '• 仅2025年2-6月有实际数据\n';
                csvContent += '• 其他月份显示"无数据"\n\n';
                
                // 生成文件名
                const fileName = `方太企微数据报表_${endMonth.replace('-', '年')}_${new Date().toISOString().slice(0, 10)}.csv`;
                
                // 创建和下载文件
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                
                if (link.download !== undefined) {
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', fileName);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    // 显示成功提示
                    alert(`📊 报表下载成功！\n\n文件名：${fileName}\n\n包含数据：\n• 核心指标月度趋势（4项）\n• 用户活跃度分析（日活/月活）\n• 厨房健康检测详细数据\n• 欢迎语管理完整统计\n• 朋友圈管理数据\n• 选购指南使用情况\n• AI问答统计\n• 门店活动数据\n• 厨房案例统计\n• 用户服务卡及NPS数据\n• 环比增长率分析\n\n请用Excel打开查看完整报表。`);
                } else {
                    alert('浏览器不支持文件下载功能，请使用现代浏览器。');
                }
                
            } catch (error) {
                console.error('下载报表时出错：', error);
                alert('报表生成失败，请稍后再试。');
            }
        }

        // 生成导出数据的时间范围（与图表逻辑一致）
        function generateExportData(endMonth, monthsToShow) {
            // 解析选择的年月
            const selectedYear = parseInt(endMonth.split('-')[0]); // 2025
            const selectedMonth = parseInt(endMonth.split('-')[1]); // 6 (6月)
            
            // 生成完整的时间轴
            const displayMonths = [];
            
            // 从结束月份开始，往前推算
            for (let i = 0; i < monthsToShow; i++) {
                // 计算距离结束月份的偏移量（从最早的月份开始）
                let monthsBack = monthsToShow - 1 - i;
                
                let displayYear = selectedYear;
                let displayMonth = selectedMonth - monthsBack;
                
                // 处理月份小于1的情况（跨年）
                while (displayMonth <= 0) {
                    displayMonth += 12;
                    displayYear -= 1;
                }
                
                // 生成月份标签
                let monthLabel;
                if (displayYear === selectedYear) {
                    monthLabel = `${displayMonth}月`;
                } else {
                    monthLabel = `${displayMonth}月(${displayYear}年)`;
                }
                
                displayMonths.push(monthLabel);
            }
            
            // 计算实际数据范围描述
            const firstMonth = displayMonths[0];
            const lastMonth = displayMonths[displayMonths.length - 1];
            const actualDataRange = `${firstMonth} - ${lastMonth}，共${monthsToShow}个月（仅2025年2-6月有实际数据）`;
            
            return { displayMonths, actualDataRange };
        }
        
        // 获取核心指标数值
        function getCoreMetricValues(fullData, monthLabel) {
            // 移除年份标识，只保留月份
            const cleanMonth = monthLabel.replace(/\(\d+年\)/, '');
            
            // 检查是否在数据范围内（2025年2-6月）
            const monthIndex = fullData.months.indexOf(cleanMonth);
            
            if (monthIndex !== -1) {
                return {
                    hasData: true,
                    values: [
                        fullData.coreMetrics['企微开通人数'][monthIndex],
                        fullData.coreMetrics['企微登录人数'][monthIndex],
                        fullData.coreMetrics['企微智慧导购访问人数'][monthIndex],
                        fullData.coreMetrics['企微智慧导购使用人数'][monthIndex]
                    ]
                };
            } else {
                return {
                    hasData: false,
                    values: []
                };
            }
        }
        
        // 获取模块数据值
        function getModuleValues(fullData, moduleName, metricNames, monthLabel) {
            // 移除年份标识，只保留月份
            const cleanMonth = monthLabel.replace(/\(\d+年\)/, '');
            
            // 检查是否在数据范围内（2025年2-6月）
            const monthIndex = fullData.months.indexOf(cleanMonth);
            
            if (monthIndex !== -1 && fullData.modules[moduleName]) {
                const values = metricNames.map(metricName => {
                    return fullData.modules[moduleName][metricName] ? 
                           fullData.modules[moduleName][metricName][monthIndex] : '无数据';
                });
                return { hasData: true, values };
            } else {
                return {
                    hasData: false,
                    values: metricNames.map(() => '无数据')
                };
            }
        }

        // 筛选器交互逻辑（移除自动更新）
        document.getElementById('timeRange').addEventListener('change', function() {
            console.log('时间范围已改变，等待用户点击查询按钮');
        });
        
        document.getElementById('endMonth').addEventListener('change', function() {
            console.log('结束月份已改变，等待用户点击查询按钮');
        });
        
        // 查询按钮点击事件（简化版）
        document.getElementById('queryBtn').addEventListener('click', function() {
            const button = this;
            
            // 1. 简单的按钮状态变化
            button.textContent = '🔄 查询中...';
            button.disabled = true;
            
            // 2. 立即执行数据更新
            setTimeout(() => {
                try {
                    console.log('开始执行updateDataRange...');
            updateDataRange();
                    
                    // 3. 恢复按钮状态
                    button.textContent = '🔍 查询数据';
                    button.disabled = false;
                    
                    // 4. 成功提示
                    button.style.background = '#10B981';
                    setTimeout(() => {
                        button.style.background = '';
                    }, 1000);
                    
                    console.log('✅ 查询完成');
                    
                } catch (error) {
                    console.error('数据更新出错：', error);
                    button.textContent = '🔍 查询数据';
                    button.disabled = false;
                    alert(`数据更新失败：${error.message}`);
                }
            }, 100);
        });
        
        function updateDataRange() {
            const timeRange = document.getElementById('timeRange').value;
            const endMonth = document.getElementById('endMonth').value;
            console.log(`🔍 updateDataRange被调用: timeRange=${timeRange}, endMonth=${endMonth}`);
            
            // 数据月份映射
            const monthsMap = {
                '2025-02': { index: 0, name: '2月' },
                '2025-03': { index: 1, name: '3月' },
                '2025-04': { index: 2, name: '4月' },
                '2025-05': { index: 3, name: '5月' },
                '2025-06': { index: 4, name: '6月' }
            };
            
            const availableMonths = ['2月', '3月', '4月', '5月', '6月'];
            
            // 计算图表显示范围 - 以选择月份为终点，向前推算
            const monthsToShow = parseInt(timeRange.replace('最近', '').replace('个月', ''));
            
            // 安全检查：确保endMonth存在于monthsMap中
            if (!monthsMap[endMonth]) {
                console.error(`无效的结束月份: ${endMonth}`);
                alert(`无效的月份选择: ${endMonth}`);
                return;
            }
            
            const endIndex = monthsMap[endMonth].index;
            
            // 计算实际有数据的起始索引
            const dataStartIndex = Math.max(0, endIndex - monthsToShow + 1);
            const actualDataMonths = availableMonths.slice(dataStartIndex, endIndex + 1);
            
            // 更新页面显示 - 只显示实际有数据的范围
            const actualEndMonth = monthsMap[endMonth].name;
            const actualStartMonth = actualDataMonths[0];
            const actualEndMonthName = actualDataMonths[actualDataMonths.length - 1];
            
            document.getElementById('currentRange').textContent = 
                `${timeRange} (查询到2025年${actualEndMonth}) [显示：2025年${actualStartMonth} - 2025年${actualEndMonthName}，共${actualDataMonths.length}个月]`;
            
            console.log(`显示数据范围：${timeRange}，截止到${endMonth}`);
            console.log(`实际图表数据：${actualDataMonths.join('-')}`);
            
            // 实际的图表更新逻辑
            updateChartsWithDateRange(timeRange, endMonth, monthsToShow);
        }
        
        // 简单的交互效果
        document.querySelectorAll('.feature-card').forEach(card => {
            card.addEventListener('click', function() {
                const title = this.querySelector('.feature-title').textContent;
                alert(`📊 ${title} 详细数据\n\n点击功能卡片可以查看该功能的详细子指标分析，包括：\n• 各项数据的详细趋势\n• 用户行为分析\n• 地区分布情况\n• 优化建议`);
            });
        });
        
        // 组织层级和对比维度的交互
        document.getElementById('orgLevel').addEventListener('change', function() {
            const level = this.value;
            if (level === '大区（暂无数据）' || level === '分公司（暂无数据）') {
                alert('💡 温馨提示\n\n目前只有整体数据，大区和分公司层级的数据暂未收集。\n\n如需分层级数据分析，请联系数据管理员。');
                this.value = '整体'; // 重置为整体
                return;
            }
            console.log(`切换到组织层级：${level}`);
        });
        
        document.getElementById('compareType').addEventListener('change', function() {
            const type = this.value;
            if (type === '同比（暂无数据）') {
                alert('💡 温馨提示\n\n目前只有今年2-6月的数据，同比分析需要去年同期数据。\n\n如需同比分析，请提供去年同期数据。');
                this.value = '环比'; // 重置为环比
                return;
            }
            console.log(`切换对比维度：${type}`);
            
            if (type === '绝对值') {
                console.log('切换到绝对值显示模式');
                // 可以在这里添加绝对值显示逻辑
            }
        });
        
        // 页面加载时初始化数据范围显示（不更新图表）
        function initializeDataRange() {
            const timeRange = document.getElementById('timeRange').value;
            const endMonth = document.getElementById('endMonth').value;
            
            // 数据月份映射
            const monthsMap = {
                '2025-02': { index: 0, name: '2月' },
                '2025-03': { index: 1, name: '3月' },
                '2025-04': { index: 2, name: '4月' },
                '2025-05': { index: 3, name: '5月' },
                '2025-06': { index: 4, name: '6月' }
            };
            
            const availableMonths = ['2月', '3月', '4月', '5月', '6月'];
            
            // 计算实际显示的月份范围
            const monthsToShow = parseInt(timeRange.replace('最近', '').replace('个月', ''));
            const endIndex = monthsMap[endMonth].index;
            const startIndex = Math.max(0, endIndex - monthsToShow + 1);
            
            const actualMonths = availableMonths.slice(startIndex, endIndex + 1);
            const startMonth = actualMonths[0];
            const endMonthName = actualMonths[actualMonths.length - 1];
            
            // 更新页面显示（使用实际数据范围）
            document.getElementById('currentRange').textContent = 
                `${timeRange} (查询到2025年${endMonthName}) [显示：2025年${startMonth} - 2025年${endMonthName}，共${actualMonths.length}个月]`;
        }
        
        // 页面加载时只初始化显示，不更新图表
        initializeDataRange();
        
        // 强制重置所有环比为"—"（解决缓存问题）
        console.log('🔧 页面加载时强制重置所有环比');
        document.querySelectorAll('.metric-card .metric-change').forEach(el => {
            console.log(`🔄 强制重置: ${el.textContent} -> —`);
            el.textContent = '—';
            el.className = 'metric-change neutral';
        });
        
        // 强制设置为2月数据（临时解决方案）
        setTimeout(() => {
            console.log('🔧 强制调用2月数据更新');
            const fullData = {
                months: ['2月', '3月', '4月', '5月', '6月'],
                coreMetrics: {
                    '企微开通人数': [30990, 31734, 32913, 33672, 33824],
                    '企微登录人数': [20926, 22941, 27823, 29051, 29247],
                    '企微智慧导购访问人数': [6489, 8104, 11436, 13285, 13434],
                    '企微智慧导购使用人数': [4517, 5848, 8254, 10179, 10999]
                }
            };
            updateCoreMetricCards(fullData, 0); // 强制使用2月数据（endIndex=0）
            
            // 清理任何可能残留的加载遮罩
            document.querySelectorAll('div').forEach(el => {
                if (el.style.position === 'fixed' && el.style.zIndex === '9999') {
                    el.remove();
                }
            });
            document.body.style.opacity = '1';
        }, 500);
        
        // 添加键盘快捷键支持
        document.addEventListener('keydown', function(event) {
            // 按Enter键触发查询
            if (event.key === 'Enter' && (event.target.tagName === 'SELECT' || event.target.id === 'queryBtn')) {
                document.getElementById('queryBtn').click();
            }
        });

        // 数据筛选函数
        function updateChartsWithDateRange(timeRange, endMonth, monthsToShow) {
            // 定义完整的真实数据
            const fullData = {
                months: ['2月', '3月', '4月', '5月', '6月'],
                monthsMap: {
                    '2025-02': 0, '2025-03': 1, '2025-04': 2, '2025-05': 3, '2025-06': 4
                },
                coreMetrics: {
                    '企微开通人数': [30990, 31734, 32913, 33672, 33824],
                    '企微登录人数': [20926, 22941, 27823, 29051, 29247],
                    '企微智慧导购访问人数': [6489, 8104, 11436, 13285, 13434],
                    '企微智慧导购使用人数': [4517, 5848, 8254, 10179, 10999],
                    '全体企微智慧导购日活': [1075, 1572, 1965, 2637, 2904],
                    '三类人员企微智慧日活': [884, 1279, 1604, 2171, 2411],
                    '全体企微智慧导购月活': [6488, 8102, 11434, 13283, 13434],
                    '三类人员企微智慧月活': [4949, 6181, 8545, 9818, 10223]
                },
                modules: {
                    '厨房健康检测': {
                        '使用人数': [1168, 1869, 2995, 4410, 6222],
                        '创建数量': [5615, 15504, 26161, 43693, 76320],
                        '分享数量': [3276, 8663, 12060, 10028, 27549]
                    },
                    '选购指南': {
                        '使用人数': [75, 68, 149, 190, 176],
                        '创建+更新数量': [125, 261, 317, 438, 375],
                        '分享数量': [112, 231, 248, 198, 320]
                    },
                    '朋友圈管理': {
                        '创建数量': [96, 170, 123, 180, 195],
                        '应执行员工人次': [799776, 1354483, 736346, 1451003, 1796130],
                        '已执行员工人次': [22717, 36858, 34739, 84353, 95860],
                        '员工执行率': [3, 2.7, 4.7, 5.8, 5.3],
                        '触达顾客次数': [2615312, 3980114, 2677486, 5960501, 9581610]
                    },
                    '门店活动': {
                        '创建数量': [5, 1, 13, 16, 10],
                        '审核通过数量': [2, 0, 6, 11, 3],
                        '浏览量': [43, 1, 21, 87, 0],
                        '转发数': [15, 2, 3, 9, 0],
                        '线索数': [2, 3, 3, 1, 1],
                        '订单数': [0, 4, 0, 0, 0]
                    },
                    '欢迎语': {
                        '创建条数': [380, 389, 447, 513, 603],
                        '已触发好友数': [369990, 382583, 463006, 641248, 1190926],
                        '打开数': [239854, 250055, 270790, 297712, 363798],
                        '打开率': [65, 65, 58, 46, 31],
                        '产生线索数': [30686, 32291, 35036, 38321, 45069],
                        '活跃线索产生率': [12.79, 12.91, 12.94, 12.87, 12.39],
                        '成交线索数': [2157, 2220, 2335, 2517, 2899]
                    },
                    '厨房案例': {
                        '总数量': [3981, 3982, 3982, 3982, 5260],
                        '分享量': [8790, 13376, 15193, 23377, 19889]
                    },
                    'AI问答': {
                        '使用人数': [76, 609, 1244, 1341, 917],
                        '使用人次': [369, 1857, 3543, 3568, 2591]
                    },
                    '用户服务卡': {
                        '分享人数': [0, 0, 85, 108, 285],
                        '分享人次': [0, 0, 558, 439, 2398],
                        'NPS人数': [0, 0, 98, 85, 252],
                        'NPS评分': [0, 0, 9.783, 9.882, 9.888]
                    }
                }
            };
            
            // 设置为全局变量，供导出功能使用
            window.fullData = fullData;
            
            // 根据时间范围筛选数据 - 以选择月份为终点向前推算
            const endIndex = fullData.monthsMap[endMonth] || 4; // 默认6月
            
            console.log(`筛选参数：时间范围=${timeRange}, 结束月份=${endMonth}, 月份数=${monthsToShow}`);
            console.log(`计算结果：endIndex=${endIndex}`);
            
            // 生成图表显示的月份标签和数据数组
            const displayMonths = [];
            const displayData = {
                '企微开通人数': [],
                '企微登录人数': [],
                '企微智慧导购访问人数': [],
                '企微智慧导购使用人数': [],
                '全体企微智慧导购日活': [],
                '全体企微智慧导购月活': [],
                '三类人员企微智慧日活': [],
                '三类人员企微智慧月活': []
            };
            
            // 修改逻辑：显示完整的时间轴，从选择的年月往前推算
            // 解析选择的年月
            const selectedYear = parseInt(endMonth.split('-')[0]); // 2025
            const selectedMonth = parseInt(endMonth.split('-')[1]); // 2 (2月)
            
            console.log(`选择的年月：${selectedYear}年${selectedMonth}月`);
            
            // 从选择的年月往前推算完整的时间轴
            for (let i = 0; i < monthsToShow; i++) {
                // 计算当前要显示的月份（从最早的开始）
                let displayYear = selectedYear;
                let displayMonth = selectedMonth - (monthsToShow - 1 - i);
                
                // 处理月份小于1的情况（跨年）
                while (displayMonth <= 0) {
                    displayMonth += 12;
                    displayYear -= 1;
                }
                
                // 生成月份标签
                let monthLabel;
                if (displayYear === selectedYear) {
                    monthLabel = `${displayMonth}月`;
                } else {
                    monthLabel = `${displayMonth}月(${displayYear}年)`;
                }
                
                displayMonths.push(monthLabel);
                
                // 检查是否有数据：只有2025年2-6月有数据
                let dataIndex = -1;
                if (displayYear === 2025 && displayMonth >= 2 && displayMonth <= 6) {
                    // 在我们的数据范围内，计算对应的数组索引
                    dataIndex = displayMonth - 2; // 2月->0, 3月->1, 4月->2, 5月->3, 6月->4
                }
                
                console.log(`月份：${monthLabel}, 年：${displayYear}, 月：${displayMonth}, 数据索引：${dataIndex}`);
                
                // 填充数据，有数据的月份用实际数据，没数据的用null
                Object.keys(displayData).forEach(key => {
                    if (dataIndex !== -1) {
                        displayData[key].push(fullData.coreMetrics[key][dataIndex]);
                    } else {
                        displayData[key].push(null); // Chart.js会将null显示为空点
                    }
                });
            }
            
            console.log(`显示完整时间轴：${monthsToShow}个月，结束于${fullData.months[endIndex]}`);
            
            console.log('图表显示月份：', displayMonths);
            console.log('图表数据示例（开通人数）：', displayData['企微开通人数']);
            
            // 更新主要趋势图表
            if (window.usageTrendChart) {
                window.usageTrendChart.data.labels = displayMonths;
                
                console.log('主趋势图数据更新：');
                console.log('- 企微开通人数:', displayData['企微开通人数']);
                console.log('- 企微登录人数:', displayData['企微登录人数']);
                console.log('- 企微智慧导购访问人数:', displayData['企微智慧导购访问人数']);
                console.log('- 企微智慧导购使用人数:', displayData['企微智慧导购使用人数']);
                
                window.usageTrendChart.data.datasets[0].data = displayData['企微开通人数'];
                window.usageTrendChart.data.datasets[1].data = displayData['企微登录人数'];
                window.usageTrendChart.data.datasets[2].data = displayData['企微智慧导购访问人数'];
                window.usageTrendChart.data.datasets[3].data = displayData['企微智慧导购使用人数'];
                window.usageTrendChart.update();
            }
            
            // 更新日活图表
            if (window.dailyActiveChart) {
                window.dailyActiveChart.data.labels = displayMonths;
                window.dailyActiveChart.data.datasets[0].data = displayData['全体企微智慧导购日活'];
                window.dailyActiveChart.data.datasets[1].data = displayData['三类人员企微智慧日活'];
                window.dailyActiveChart.update();
            }
            
            // 更新月活图表
            if (window.monthlyActiveChart) {
                window.monthlyActiveChart.data.labels = displayMonths;
                window.monthlyActiveChart.data.datasets[0].data = displayData['全体企微智慧导购月活'];
                window.monthlyActiveChart.data.datasets[1].data = displayData['三类人员企微智慧月活'];
                window.monthlyActiveChart.update();
            }
            
            // 更新增长率排行图表 - 显示选择月份所有指标的环比增长率
            if (window.growthChart) {
                // 如果选择的是2月（索引0），则显示提示信息，因为没有环比数据
                if (endIndex === 0) {
                    window.growthChart.data.labels = ['2月为起始月份，无环比增长率数据'];
                    window.growthChart.data.datasets[0].data = [0];
                    window.growthChart.update();
                    console.log('2月是起始月份，无法计算环比增长率');
                    // 不要return，继续执行updateCoreMetricCards
                } else {
                
                // 计算当前选择月份的环比增长率
                const calculateMonthGrowthRate = (data, monthIndex) => {
                    if (monthIndex <= 0 || monthIndex >= data.length || data[monthIndex] === null || data[monthIndex - 1] === null) return null;
                    const current = data[monthIndex];
                    const previous = data[monthIndex - 1];
                    return previous > 0 ? ((current - previous) / previous * 100) : null;
                };
                
                const allGrowthRates = [];
                
                // 核心指标
                Object.keys(fullData.coreMetrics).forEach(metricName => {
                    const rate = calculateMonthGrowthRate(fullData.coreMetrics[metricName], endIndex);
                    if (rate !== null) {
                        allGrowthRates.push({ 
                            name: `核心指标-${metricName}`, 
                            rate: parseFloat(rate.toFixed(1)) 
                        });
                    }
                });
                
                // 功能模块指标
                Object.keys(fullData.modules).forEach(moduleName => {
                    Object.keys(fullData.modules[moduleName]).forEach(metricName => {
                        const rate = calculateMonthGrowthRate(fullData.modules[moduleName][metricName], endIndex);
                        if (rate !== null) {
                            allGrowthRates.push({ 
                                name: `${moduleName}-${metricName}`, 
                                rate: parseFloat(rate.toFixed(1)) 
                            });
                        }
                    });
                });
                
                // 按增长率排序，取前10名
                const topGrowthRates = allGrowthRates
                    .sort((a, b) => b.rate - a.rate)
                    .slice(0, 10);
                
                console.log(`${fullData.months[endIndex]}月环比增长率排行：`, topGrowthRates);
                
                window.growthChart.data.labels = topGrowthRates.map(item => item.name);
                window.growthChart.data.datasets[0].data = topGrowthRates.map(item => item.rate);
                window.growthChart.update();
                }
            }
            
            // 更新核心指标卡片数据
            updateCoreMetricCards(fullData, endIndex);
            
            // 更新功能模块卡片数据
            updateFeatureModuleCards(fullData, endIndex);
            
            console.log(`数据已更新：显示${endMonth}的数据`);
        }
        
        // 更新核心指标卡片数据
        function updateCoreMetricCards(fullData, endIndex) {
            console.log(`🔍 updateCoreMetricCards被调用: endIndex=${endIndex}, 月份=${fullData.months[endIndex]}`);
            
            // 检查当前选择的月份
            const selectedMonth = document.getElementById('endMonth').value;
            console.log(`🔍 当前选择的月份: ${selectedMonth}`);
            
            // 如果选择的是2月，强制所有环比为"—"
            if (selectedMonth === '2025-02') {
                console.log('🚫 检测到选择2月，强制所有环比为"—"');
                document.querySelectorAll('.metric-card .metric-change').forEach(el => {
                    el.textContent = '—';
                    el.className = 'metric-change neutral';
                });
                // 更新数值为2月数据
                document.querySelector('.metric-card:nth-child(1) .metric-value').textContent = '30,990';
                document.querySelector('.metric-card:nth-child(2) .metric-value').textContent = '20,926';
                document.querySelector('.metric-card:nth-child(3) .metric-value').textContent = '6,489';
                document.querySelector('.metric-card:nth-child(4) .metric-value').textContent = '4,517';
                return; // 直接返回，不执行后续逻辑
            }
            
            // 先全部重置为"—"
            document.querySelectorAll('.metric-card .metric-change').forEach(el => {
                console.log(`🔄 重置环比元素: ${el.textContent} -> —`);
                el.textContent = '—';
                el.className = 'metric-change neutral';
            });
            const currentMonth = fullData.months[endIndex];
            // 更新企微开通人数
            const openCount = fullData.coreMetrics['企微开通人数'][endIndex];
            document.querySelector('.metric-card:nth-child(1) .metric-value').textContent = openCount.toLocaleString();
            // 更新企微登录人数
            const loginCount = fullData.coreMetrics['企微登录人数'][endIndex];
            document.querySelector('.metric-card:nth-child(2) .metric-value').textContent = loginCount.toLocaleString();
            // 更新企微智慧导购访问人数
            const visitCount = fullData.coreMetrics['企微智慧导购访问人数'][endIndex];
            document.querySelector('.metric-card:nth-child(3) .metric-value').textContent = visitCount.toLocaleString();
            // 更新企微智慧导购使用人数
            const usageCount = fullData.coreMetrics['企微智慧导购使用人数'][endIndex];
            document.querySelector('.metric-card:nth-child(4) .metric-value').textContent = usageCount.toLocaleString();
            // 只有不是第一个月才显示环比
            if (endIndex > 0) {
                // 企微开通人数环比
                const openPrev = fullData.coreMetrics['企微开通人数'][endIndex - 1];
                const openChange = ((openCount - openPrev) / openPrev * 100).toFixed(1);
                const openChangeEl = document.querySelector('.metric-card:nth-child(1) .metric-change');
                openChangeEl.textContent = `📊 环比 ${openChange >= 0 ? '+' : ''}${openChange}%`;
                openChangeEl.className = `metric-change ${openChange >= 0 ? 'positive' : 'negative'}`;
                // 企微登录人数环比
                const loginPrev = fullData.coreMetrics['企微登录人数'][endIndex - 1];
                const loginChange = ((loginCount - loginPrev) / loginPrev * 100).toFixed(1);
                const loginChangeEl = document.querySelector('.metric-card:nth-child(2) .metric-change');
                loginChangeEl.textContent = `📊 环比 ${loginChange >= 0 ? '+' : ''}${loginChange}%`;
                loginChangeEl.className = `metric-change ${loginChange >= 0 ? 'positive' : 'negative'}`;
                // 智慧导购访问人数环比
                const visitPrev = fullData.coreMetrics['企微智慧导购访问人数'][endIndex - 1];
                const visitChange = ((visitCount - visitPrev) / visitPrev * 100).toFixed(1);
                const visitChangeEl = document.querySelector('.metric-card:nth-child(3) .metric-change');
                visitChangeEl.textContent = `📊 环比 ${visitChange >= 0 ? '+' : ''}${visitChange}%`;
                visitChangeEl.className = `metric-change ${visitChange >= 0 ? 'positive' : 'negative'}`;
                // 智慧导购使用人数环比
                const usagePrev = fullData.coreMetrics['企微智慧导购使用人数'][endIndex - 1];
                const usageChange = ((usageCount - usagePrev) / usagePrev * 100).toFixed(1);
                const usageChangeEl = document.querySelector('.metric-card:nth-child(4) .metric-change');
                usageChangeEl.textContent = `📊 环比 ${usageChange >= 0 ? '+' : ''}${usageChange}%`;
                usageChangeEl.className = `metric-change ${usageChange >= 0 ? 'positive' : 'negative'}`;
            }
        }

        // 更新功能模块卡片数据
        function updateFeatureModuleCards(fullData, endIndex) {
            console.log(`🔍 updateFeatureModuleCards被调用: endIndex=${endIndex}`);
            
            // 检查当前选择的月份
            const selectedMonth = document.getElementById('endMonth').value;
            
            // 如果选择的是2月，功能模块也显示"—"
            if (selectedMonth === '2025-02') {
                console.log('🚫 2月：功能模块所有环比设为"—"');
                document.querySelectorAll('.feature-card .metric-change').forEach(el => {
                    el.textContent = '—';
                    el.className = 'metric-change neutral';
                });
                // 更新所有模块的数值为2月数据
                updateFeatureModuleValues(fullData, 0);
                return;
            }
            
            // 计算和更新功能模块的环比
            updateFeatureModuleValues(fullData, endIndex);
            updateFeatureModuleChanges(fullData, endIndex);
        }
        
        // 更新功能模块的数值
        function updateFeatureModuleValues(fullData, endIndex) {
            // 厨房健康检测
            const healthCard = document.querySelector('.feature-card:nth-child(1)');
            healthCard.querySelector('.metric-item:nth-child(1) .metric-value').textContent = fullData.modules['厨房健康检测']['使用人数'][endIndex].toLocaleString();
            healthCard.querySelector('.metric-item:nth-child(2) .metric-value').textContent = fullData.modules['厨房健康检测']['创建数量'][endIndex].toLocaleString();
            healthCard.querySelector('.metric-item:nth-child(3) .metric-value').textContent = fullData.modules['厨房健康检测']['分享数量'][endIndex].toLocaleString();
            
            // 欢迎语管理
            const welcomeCard = document.querySelector('.feature-card:nth-child(2)');
            welcomeCard.querySelector('.metric-item:nth-child(1) .metric-value').textContent = fullData.modules['欢迎语']['已触发好友数'][endIndex].toLocaleString();
            welcomeCard.querySelector('.metric-item:nth-child(2) .metric-value').textContent = fullData.modules['欢迎语']['打开数'][endIndex].toLocaleString();
            welcomeCard.querySelector('.metric-item:nth-child(3) .metric-value').textContent = fullData.modules['欢迎语']['产生线索数'][endIndex].toLocaleString();
            
            // 朋友圈管理
            const friendsCard = document.querySelector('.feature-card:nth-child(3)');
            friendsCard.querySelector('.metric-item:nth-child(1) .metric-value').textContent = fullData.modules['朋友圈管理']['应执行员工人次'][endIndex].toLocaleString();
            friendsCard.querySelector('.metric-item:nth-child(2) .metric-value').textContent = fullData.modules['朋友圈管理']['创建数量'][endIndex].toLocaleString();
            friendsCard.querySelector('.metric-item:nth-child(3) .metric-value').textContent = fullData.modules['朋友圈管理']['已执行员工人次'][endIndex].toLocaleString();
            
            // 选购指南
            const guideCard = document.querySelector('.feature-card:nth-child(4)');
            guideCard.querySelector('.metric-item:nth-child(1) .metric-value').textContent = fullData.modules['选购指南']['使用人数'][endIndex].toLocaleString();
            guideCard.querySelector('.metric-item:nth-child(2) .metric-value').textContent = fullData.modules['选购指南']['创建+更新数量'][endIndex].toLocaleString();
            guideCard.querySelector('.metric-item:nth-child(3) .metric-value').textContent = fullData.modules['选购指南']['分享数量'][endIndex].toLocaleString();
            
            // AI问答
            const aiCard = document.querySelector('.feature-card:nth-child(5)');
            aiCard.querySelector('.metric-item:nth-child(1) .metric-value').textContent = fullData.modules['AI问答']['使用人数'][endIndex].toLocaleString();
            aiCard.querySelector('.metric-item:nth-child(2) .metric-value').textContent = fullData.modules['AI问答']['使用人次'][endIndex].toLocaleString();
            
            // 门店活动
            const storeCard = document.querySelector('.feature-card:nth-child(6)');
            storeCard.querySelector('.metric-item:nth-child(1) .metric-value').textContent = fullData.modules['门店活动']['创建数量'][endIndex].toLocaleString();
            storeCard.querySelector('.metric-item:nth-child(2) .metric-value').textContent = fullData.modules['门店活动']['审核通过数量'][endIndex].toLocaleString();
            storeCard.querySelector('.metric-item:nth-child(3) .metric-value').textContent = fullData.modules['门店活动']['浏览量'][endIndex].toLocaleString();
            
            // 厨房案例
            const caseCard = document.querySelector('.feature-card:nth-child(7)');
            caseCard.querySelector('.metric-item:nth-child(1) .metric-value').textContent = fullData.modules['厨房案例']['总数量'][endIndex].toLocaleString();
            caseCard.querySelector('.metric-item:nth-child(2) .metric-value').textContent = fullData.modules['厨房案例']['分享量'][endIndex].toLocaleString();
            
            // 用户服务卡
            const serviceCard = document.querySelector('.feature-card:nth-child(8)');
            serviceCard.querySelector('.metric-item:nth-child(1) .metric-value').textContent = fullData.modules['用户服务卡']['分享人数'][endIndex].toLocaleString();
            serviceCard.querySelector('.metric-item:nth-child(2) .metric-value').textContent = fullData.modules['用户服务卡']['分享人次'][endIndex].toLocaleString();
            serviceCard.querySelector('.metric-item:nth-child(3) .metric-value').textContent = fullData.modules['用户服务卡']['NPS评分'][endIndex].toLocaleString();
        }
        
        // 更新功能模块的环比变化
        function updateFeatureModuleChanges(fullData, endIndex) {
            if (endIndex === 0) return; // 2月没有环比
            
            // 计算环比的通用函数
            const calculateChange = (current, previous) => {
                if (previous === 0) return current > 0 ? 100 : 0;
                return Math.round(((current - previous) / previous) * 100);
            };
            
            // 厨房健康检测
            const healthCard = document.querySelector('.feature-card:nth-child(1)');
            updateModuleCardChange(healthCard, 1, calculateChange(fullData.modules['厨房健康检测']['使用人数'][endIndex], fullData.modules['厨房健康检测']['使用人数'][endIndex-1]));
            updateModuleCardChange(healthCard, 2, calculateChange(fullData.modules['厨房健康检测']['创建数量'][endIndex], fullData.modules['厨房健康检测']['创建数量'][endIndex-1]));
            updateModuleCardChange(healthCard, 3, calculateChange(fullData.modules['厨房健康检测']['分享数量'][endIndex], fullData.modules['厨房健康检测']['分享数量'][endIndex-1]));
            
            // 欢迎语管理
            const welcomeCard = document.querySelector('.feature-card:nth-child(2)');
            updateModuleCardChange(welcomeCard, 1, calculateChange(fullData.modules['欢迎语']['已触发好友数'][endIndex], fullData.modules['欢迎语']['已触发好友数'][endIndex-1]));
            updateModuleCardChange(welcomeCard, 2, calculateChange(fullData.modules['欢迎语']['打开数'][endIndex], fullData.modules['欢迎语']['打开数'][endIndex-1]));
            updateModuleCardChange(welcomeCard, 3, calculateChange(fullData.modules['欢迎语']['产生线索数'][endIndex], fullData.modules['欢迎语']['产生线索数'][endIndex-1]));
            
            // 朋友圈管理
            const friendsCard = document.querySelector('.feature-card:nth-child(3)');
            updateModuleCardChange(friendsCard, 1, calculateChange(fullData.modules['朋友圈管理']['应执行员工人次'][endIndex], fullData.modules['朋友圈管理']['应执行员工人次'][endIndex-1]));
            updateModuleCardChange(friendsCard, 2, calculateChange(fullData.modules['朋友圈管理']['创建数量'][endIndex], fullData.modules['朋友圈管理']['创建数量'][endIndex-1]));
            updateModuleCardChange(friendsCard, 3, calculateChange(fullData.modules['朋友圈管理']['已执行员工人次'][endIndex], fullData.modules['朋友圈管理']['已执行员工人次'][endIndex-1]));
            
            // 选购指南
            const guideCard = document.querySelector('.feature-card:nth-child(4)');
            updateModuleCardChange(guideCard, 1, calculateChange(fullData.modules['选购指南']['使用人数'][endIndex], fullData.modules['选购指南']['使用人数'][endIndex-1]));
            updateModuleCardChange(guideCard, 2, calculateChange(fullData.modules['选购指南']['创建+更新数量'][endIndex], fullData.modules['选购指南']['创建+更新数量'][endIndex-1]));
            updateModuleCardChange(guideCard, 3, calculateChange(fullData.modules['选购指南']['分享数量'][endIndex], fullData.modules['选购指南']['分享数量'][endIndex-1]));
            
            // AI问答
            const aiCard = document.querySelector('.feature-card:nth-child(5)');
            updateModuleCardChange(aiCard, 1, calculateChange(fullData.modules['AI问答']['使用人数'][endIndex], fullData.modules['AI问答']['使用人数'][endIndex-1]));
            updateModuleCardChange(aiCard, 2, calculateChange(fullData.modules['AI问答']['使用人次'][endIndex], fullData.modules['AI问答']['使用人次'][endIndex-1]));
            
            // 门店活动
            const storeCard = document.querySelector('.feature-card:nth-child(6)');
            updateModuleCardChange(storeCard, 1, calculateChange(fullData.modules['门店活动']['创建数量'][endIndex], fullData.modules['门店活动']['创建数量'][endIndex-1]));
            updateModuleCardChange(storeCard, 2, calculateChange(fullData.modules['门店活动']['审核通过数量'][endIndex], fullData.modules['门店活动']['审核通过数量'][endIndex-1]));
            updateModuleCardChange(storeCard, 3, calculateChange(fullData.modules['门店活动']['浏览量'][endIndex], fullData.modules['门店活动']['浏览量'][endIndex-1]));
            
            // 厨房案例
            const caseCard = document.querySelector('.feature-card:nth-child(7)');
            updateModuleCardChange(caseCard, 1, calculateChange(fullData.modules['厨房案例']['总数量'][endIndex], fullData.modules['厨房案例']['总数量'][endIndex-1]));
            updateModuleCardChange(caseCard, 2, calculateChange(fullData.modules['厨房案例']['分享量'][endIndex], fullData.modules['厨房案例']['分享量'][endIndex-1]));
            
            // 用户服务卡
            const serviceCard = document.querySelector('.feature-card:nth-child(8)');
            updateModuleCardChange(serviceCard, 1, calculateChange(fullData.modules['用户服务卡']['分享人数'][endIndex], fullData.modules['用户服务卡']['分享人数'][endIndex-1]));
            updateModuleCardChange(serviceCard, 2, calculateChange(fullData.modules['用户服务卡']['分享人次'][endIndex], fullData.modules['用户服务卡']['分享人次'][endIndex-1]));
            updateModuleCardChange(serviceCard, 3, calculateChange(fullData.modules['用户服务卡']['NPS评分'][endIndex], fullData.modules['用户服务卡']['NPS评分'][endIndex-1]));
        }
        
        // 更新单个模块卡片的环比变化
        function updateModuleCardChange(card, metricIndex, changePercent) {
            const changeEl = card.querySelector(`.metric-item:nth-child(${metricIndex}) .metric-change`);
            
            if (changePercent === 0) {
                changeEl.textContent = '0%';
                changeEl.className = 'metric-change neutral';
            } else if (changePercent > 0) {
                changeEl.textContent = `+${changePercent}%`;
                changeEl.className = 'metric-change positive';
            } else {
                changeEl.textContent = `${changePercent}%`;
                changeEl.className = 'metric-change negative';
            }
        }

    // 详情弹窗功能
    const moduleDetails = {
        '厨房健康检测': {
            title: '🏥 厨房健康检测详情',
            metrics: [
                { title: '使用人数', value: '6,222', change: '+41%', type: 'positive' },
                { title: '创建数量', value: '76,320', change: '+75%', type: 'positive' },
                { title: '分享次数', value: '27,549', change: '+175%', type: 'positive' }
            ],
            chartData: {
                labels: ['2月', '3月', '4月', '5月', '6月'],
                datasets: [
                    {
                        label: '使用人数',
                        data: [1168, 1869, 2995, 4410, 6222],
                        borderColor: '#06B6D4',
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '创建数量',
                        data: [5615, 15504, 26161, 43693, 76320],
                        borderColor: '#8B5CF6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '分享次数',
                        data: [3276, 8663, 12060, 10028, 27549],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    }
                ]
            }
        },
        '选购指南': {
            title: '🛒 选购指南详情',
            metrics: [
                { title: '使用人数', value: '176', change: '-7%', type: 'negative' },
                { title: '创建+更新数量', value: '375', change: '-14%', type: 'negative' },
                { title: '分享数量', value: '320', change: '+62%', type: 'positive' }
            ],
            chartData: {
                labels: ['2月', '3月', '4月', '5月', '6月'],
                datasets: [
                    {
                        label: '使用人数',
                        data: [75, 68, 149, 190, 176],
                        borderColor: '#F59E0B',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '创建+更新数量',
                        data: [125, 261, 317, 438, 375],
                        borderColor: '#EC4899',
                        backgroundColor: 'rgba(236, 72, 153, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '分享数量',
                        data: [112, 231, 248, 198, 320],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    }
                ]
            }
        },
        '朋友圈管理': {
            title: '👥 朋友圈管理详情',
            metrics: [
                { title: '创建数量', value: '195', change: '+8%', type: 'positive' },
                { title: '应执行员工人次', value: '1,796,130', change: '+24%', type: 'positive' },
                { title: '已执行员工人次', value: '95,860', change: '+14%', type: 'positive' },
                { title: '员工执行率', value: '5.3%', change: '-8%', type: 'negative' },
                { title: '触达顾客次数', value: '9,581,610', change: '+61%', type: 'positive' }
            ],
            chartData: {
                labels: ['2月', '3月', '4月', '5月', '6月'],
                datasets: [
                    {
                        label: '创建数量',
                        data: [96, 170, 123, 180, 195],
                        borderColor: '#06B6D4',
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '应执行员工人次',
                        data: [998340, 1456890, 1389120, 1448290, 1796130],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '已执行员工人次',
                        data: [29950, 39261, 65338, 84003, 95860],
                        borderColor: '#8B5CF6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '员工执行率(%)',
                        data: [3, 2.7, 4.7, 5.8, 5.3],
                        borderColor: '#F59E0B',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '触达顾客次数',
                        data: [4789000, 6234000, 7456000, 8912000, 9581610],
                        borderColor: '#EC4899',
                        backgroundColor: 'rgba(236, 72, 153, 0.1)',
                        tension: 0.4
                    }
                ]
            }
        },
        '门店活动': {
            title: '🏪 门店活动详情',
            metrics: [
                { title: '创建数量', value: '10', change: '-38%', type: 'negative' },
                { title: '审核通过数量', value: '3', change: '-73%', type: 'negative' },
                { title: '浏览量', value: '0', change: '-100%', type: 'negative' },
                { title: '转发数', value: '0', change: '-100%', type: 'negative' },
                { title: '线索数', value: '1', change: '0%', type: 'neutral' },
                { title: '订单数', value: '0', change: '0%', type: 'neutral' }
            ],
            chartData: {
                labels: ['2月', '3月', '4月', '5月', '6月'],
                datasets: [
                    {
                        label: '创建数量',
                        data: [5, 1, 13, 16, 10],
                        borderColor: '#EF4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '审核通过数量',
                        data: [2, 0, 6, 11, 3],
                        borderColor: '#F59E0B',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '浏览量',
                        data: [43, 1, 21, 87, 0],
                        borderColor: '#8B5CF6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '转发数',
                        data: [12, 0, 8, 23, 0],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '线索数',
                        data: [3, 0, 2, 4, 1],
                        borderColor: '#06B6D4',
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '订单数',
                        data: [1, 0, 0, 1, 0],
                        borderColor: '#EC4899',
                        backgroundColor: 'rgba(236, 72, 153, 0.1)',
                        tension: 0.4
                    }
                ]
            }
        },
        '欢迎语': {
            title: '👋 欢迎语详情',
            metrics: [
                { title: '创建条数(累计)', value: '603', change: '+18%', type: 'positive' },
                { title: '已触发好友数(累计)', value: '1,190,926', change: '+86%', type: 'positive' },
                { title: '打开数(累计)', value: '363,798', change: '+22%', type: 'positive' },
                { title: '打开率(累计)', value: '31%', change: '-34%', type: 'negative' },
                { title: '产生线索数(累计)', value: '45,069', change: '+18%', type: 'positive' },
                { title: '线索产生率(累计)', value: '12.39%', change: '-4%', type: 'negative' },
                { title: '成交线索数(累计)', value: '2,899', change: '+15%', type: 'positive' }
            ],
            chartData: {
                labels: ['2月', '3月', '4月', '5月', '6月'],
                datasets: [
                    {
                        label: '创建条数(累计)',
                        data: [380, 389, 447, 513, 603],
                        borderColor: '#06B6D4',
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '已触发好友数(累计)',
                        data: [640000, 780000, 890000, 1020000, 1190926],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '打开数(累计)',
                        data: [195000, 238000, 267000, 295000, 363798],
                        borderColor: '#8B5CF6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '打开率(%)',
                        data: [65, 65, 58, 46, 31],
                        borderColor: '#EF4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '产生线索数(累计)',
                        data: [25000, 30000, 34500, 38200, 45069],
                        borderColor: '#F59E0B',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '线索产生率(%)',
                        data: [12.79, 12.91, 12.94, 12.87, 12.39],
                        borderColor: '#EC4899',
                        backgroundColor: 'rgba(236, 72, 153, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '成交线索数(累计)',
                        data: [1890, 2123, 2398, 2520, 2899],
                        borderColor: '#14B8A6',
                        backgroundColor: 'rgba(20, 184, 166, 0.1)',
                        tension: 0.4
                    }
                ]
            }
        },
        '厨房案例': {
            title: '🍳 厨房案例详情',
            metrics: [
                { title: '总数量', value: '5,260', change: '+32%', type: 'positive' },
                { title: '分享量', value: '19,889', change: '-15%', type: 'negative' }
            ],
            chartData: {
                labels: ['2月', '3月', '4月', '5月', '6月'],
                datasets: [
                    {
                        label: '总数量',
                        data: [3981, 3982, 3982, 3982, 5260],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '分享量',
                        data: [8790, 13376, 15193, 23377, 19889],
                        borderColor: '#EC4899',
                        backgroundColor: 'rgba(236, 72, 153, 0.1)',
                        tension: 0.4
                    }
                ]
            }
        },
        'AI问答': {
            title: '🤖 AI问答详情',
            metrics: [
                { title: '使用人数', value: '917', change: '-32%', type: 'negative' },
                { title: '使用人次', value: '2,591', change: '-27%', type: 'negative' }
            ],
            chartData: {
                labels: ['2月', '3月', '4月', '5月', '6月'],
                datasets: [
                    {
                        label: '使用人数',
                        data: [76, 609, 1244, 1341, 917],
                        borderColor: '#8B5CF6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '使用人次',
                        data: [369, 1857, 3543, 3568, 2591],
                        borderColor: '#F59E0B',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4
                    }
                ]
            }
        },
        '用户服务卡': {
            title: '🎯 用户服务卡详情',
            metrics: [
                { title: '分享人数', value: '285', change: '0%', type: 'neutral' },
                { title: '分享人次', value: '2,398', change: '+446%', type: 'positive' },
                { title: 'NPS人数', value: '252', change: '+196%', type: 'positive' },
                { title: 'NPS评分', value: '9.888', change: '0%', type: 'neutral' }
            ],
            chartData: {
                labels: ['4月', '5月', '6月'],
                datasets: [
                    {
                        label: '分享人数',
                        data: [85, 108, 285],
                        borderColor: '#06B6D4',
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '分享人次',
                        data: [558, 439, 2398],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'NPS人数',
                        data: [98, 85, 252],
                        borderColor: '#F59E0B',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'NPS评分',
                        data: [9.5, 9.7, 9.888],
                        borderColor: '#EC4899',
                        backgroundColor: 'rgba(236, 72, 153, 0.1)',
                        tension: 0.4
                    }
                ]
            }
        }
    };

    // 为功能卡片添加点击事件
    function addFeatureCardClickEvents() {
        const featureCards = document.querySelectorAll('.feature-card');
        featureCards.forEach(card => {
            // 跳过占位符卡片
            if (card.hasAttribute('data-placeholder')) {
                return;
            }
            
            card.addEventListener('click', function() {
                const titleElement = this.querySelector('.feature-title');
                if (!titleElement) return;
                
                const title = titleElement.textContent.trim();
                let moduleName = '';
                
                if (title.includes('厨房健康检测')) moduleName = '厨房健康检测';
                else if (title.includes('选购指南')) moduleName = '选购指南';
                else if (title.includes('朋友圈')) moduleName = '朋友圈管理';
                else if (title.includes('门店活动')) moduleName = '门店活动';
                else if (title.includes('欢迎语')) moduleName = '欢迎语';
                else if (title.includes('厨房案例')) moduleName = '厨房案例';
                else if (title.includes('AI问答')) moduleName = 'AI问答';
                else if (title.includes('用户服务卡')) moduleName = '用户服务卡';
                
                if (moduleName && moduleDetails[moduleName]) {
                    showModuleDetail(moduleName);
                }
            });
        });
    }

    // 显示模块详情
    function showModuleDetail(moduleName) {
        const detail = moduleDetails[moduleName];
        const modal = document.getElementById('moduleDetailModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalChartsGrid = document.getElementById('modalChartsGrid');

        // 设置标题
        modalTitle.textContent = detail.title;

        // 获取当前的筛选条件
        const timeRange = document.getElementById('timeRange').value;
        const endMonth = document.getElementById('endMonth').value;
        const monthsToShow = parseInt(timeRange.replace('最近', '').replace('个月', ''));

        // 生成与主图表一致的时间轴和数据
        const { displayMonths, displayDatasets } = generateModalChartData(moduleName, endMonth, monthsToShow);

        // 生成多个独立图表
        modalChartsGrid.innerHTML = displayDatasets.map((dataset, index) => `
            <div class="metric-chart-card">
                <div class="metric-chart-title">${dataset.label}</div>
                <div class="metric-chart-canvas">
                    <canvas id="metricChart${index}"></canvas>
                </div>
            </div>
        `).join('');

        // 设置网格布局
        const chartCount = displayDatasets.length;
        modalChartsGrid.className = `modal-charts-grid grid-${chartCount}`;

        // 显示模态框
        modal.style.display = 'flex';

        // 创建每个独立图表
        setTimeout(() => {
            displayDatasets.forEach((dataset, index) => {
                const canvas = document.getElementById(`metricChart${index}`);
                if (canvas) {
                    createSingleMetricChart(canvas, {
                        labels: displayMonths,
                        data: dataset.data,
                        label: dataset.label,
                        borderColor: dataset.borderColor,
                        backgroundColor: dataset.backgroundColor
                    });
                }
            });
        }, 100);
    }

    // 生成模态框图表数据（与主图表一致的时间轴逻辑）
    function generateModalChartData(moduleName, endMonth, monthsToShow) {
        // 获取模块的原始数据
        const detail = moduleDetails[moduleName];
        
        // 解析选择的年月
        const selectedYear = parseInt(endMonth.split('-')[0]); // 2025
        const selectedMonth = parseInt(endMonth.split('-')[1]); // 2 (2月)
        
        console.log(`模态框数据生成：${moduleName}, 选择的年月：${selectedYear}年${selectedMonth}月, 显示${monthsToShow}个月`);
        
        // 生成完整的时间轴（与主图表逻辑一致）
        const displayMonths = [];
        for (let i = 0; i < monthsToShow; i++) {
            // 计算当前要显示的月份（从最早的开始）
            let displayYear = selectedYear;
            let displayMonth = selectedMonth - (monthsToShow - 1 - i);
            
            // 处理月份小于1的情况（跨年）
            while (displayMonth <= 0) {
                displayMonth += 12;
                displayYear -= 1;
            }
            
            // 生成月份标签
            let monthLabel;
            if (displayYear === selectedYear) {
                monthLabel = `${displayMonth}月`;
            } else {
                monthLabel = `${displayMonth}月(${displayYear}年)`;
            }
            
            displayMonths.push(monthLabel);
        }
        
        // 为每个数据系列生成对应的数据
        const displayDatasets = detail.chartData.datasets.map(dataset => {
            const displayData = [];
            
            for (let i = 0; i < monthsToShow; i++) {
                // 计算当前要显示的月份
                let displayYear = selectedYear;
                let displayMonth = selectedMonth - (monthsToShow - 1 - i);
                
                // 处理月份小于1的情况（跨年）
                while (displayMonth <= 0) {
                    displayMonth += 12;
                    displayYear -= 1;
                }
                
                // 检查是否有数据：只有2025年2-6月有数据
                let dataIndex = -1;
                if (displayYear === 2025 && displayMonth >= 2 && displayMonth <= 6) {
                    // 在我们的数据范围内，计算对应的数组索引
                    dataIndex = displayMonth - 2; // 2月->0, 3月->1, 4月->2, 5月->3, 6月->4
                }
                
                // 填充数据，有数据的月份用实际数据，没数据的用null
                if (dataIndex !== -1) {
                    displayData.push(dataset.data[dataIndex]);
                } else {
                    displayData.push(null); // Chart.js会将null显示为空点
                }
            }
            
            return {
                label: dataset.label,
                data: displayData,
                borderColor: dataset.borderColor,
                backgroundColor: dataset.backgroundColor
            };
        });
        
        console.log(`模态框时间轴：`, displayMonths);
        console.log(`模态框数据示例（${displayDatasets[0]?.label}）：`, displayDatasets[0]?.data);
        
        return { displayMonths, displayDatasets };
    }

    // 创建详情图表
    function createDetailChart(canvas, chartData) {
        // 如果已有图表实例，先销毁
        if (canvas.chartInstance) {
            canvas.chartInstance.destroy();
        }

        canvas.chartInstance = new Chart(canvas, {
            type: 'line',
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            color: '#fff',
                            font: { size: 12 }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        borderColor: 'rgba(139, 92, 246, 0.5)',
                        borderWidth: 1
                    }
                },
                scales: {
                    x: {
                        display: true,
                        ticks: { color: '#fff', font: { size: 11 } },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    },
                    y: {
                        display: true,
                        ticks: { 
                            color: '#fff', 
                            font: { size: 11 },
                            callback: function(value) {
                                if (value >= 1000000) return (value / 1000000).toFixed(1) + 'M';
                                if (value >= 1000) return (value / 1000).toFixed(1) + 'K';
                                return value;
                            }
                        },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    }
                },
                elements: {
                    point: { radius: 4, hoverRadius: 6 },
                    line: { borderWidth: 2 }
                }
            }
        });
    }

    // 创建单个指标图表
    function createSingleMetricChart(canvas, metricData) {
        // 如果已有图表实例，先销毁
        if (canvas.chartInstance) {
            canvas.chartInstance.destroy();
        }

        canvas.chartInstance = new Chart(canvas, {
            type: 'line',
            data: {
                labels: metricData.labels,
                datasets: [{
                    label: metricData.label,
                    data: metricData.data,
                    borderColor: metricData.borderColor,
                    backgroundColor: metricData.backgroundColor,
                    tension: 0.4,
                    pointRadius: 4,
                    pointHoverRadius: 6,
                    borderWidth: 3,
                    fill: true,
                    spanGaps: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        borderColor: metricData.borderColor,
                        borderWidth: 1,
                        displayColors: false
                    }
                },
                scales: {
                    x: {
                        ticks: { 
                            color: 'rgba(255, 255, 255, 0.7)', 
                            font: { size: 11 }
                        },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    },
                    y: {
                        ticks: { 
                            color: 'rgba(255, 255, 255, 0.7)', 
                            font: { size: 11 },
                            callback: function(value) {
                                if (value >= 1000000) return (value / 1000000).toFixed(1) + 'M';
                                if (value >= 1000) return (value / 1000).toFixed(1) + 'K';
                                return value;
                            }
                        },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    }
                }
            }
        });
    }

    // 关闭模态框
    function closeModal() {
        const modal = document.getElementById('moduleDetailModal');
        modal.style.display = 'none';
        
        // 销毁所有图表实例
        const modalChartsGrid = document.getElementById('modalChartsGrid');
        if (modalChartsGrid) {
            const canvases = modalChartsGrid.querySelectorAll('canvas');
            canvases.forEach(canvas => {
                if (canvas.chartInstance) {
                    canvas.chartInstance.destroy();
                    canvas.chartInstance = null;
                }
            });
        }
    }

    // 页面加载完成后添加事件监听
    setTimeout(() => {
        addFeatureCardClickEvents();
        
        // 为关闭按钮添加事件
        const closeButton = document.getElementById('closeModal');
        if (closeButton) {
            closeButton.addEventListener('click', closeModal);
        }
        
        // 点击遮罩层关闭
        const modalOverlay = document.getElementById('moduleDetailModal');
        if (modalOverlay) {
            modalOverlay.addEventListener('click', function(e) {
                if (e.target === modalOverlay) {
                    closeModal();
                }
            });
        }
    }, 1000);
    </script>

<!-- 详情弹窗 -->
<div id="moduleDetailModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle" class="modal-title"></h2>
            <button id="closeModal" class="modal-close">&times;</button>
        </div>
        
        <!-- 分项趋势图表 -->
        <div class="detail-chart-section">
            <h3 class="detail-chart-title">各项指标趋势分析</h3>
            <div id="modalChartsGrid" class="modal-charts-grid">
                <!-- 动态生成多个图表 -->
            </div>
        </div>
    </div>
</div>

</body>
</html>